<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Регистрация Supabase</title>
    <!-- Подключаем Supabase SDK через CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: sans-serif; display: flex; justify-content: center; padding-top: 50px; background: #f4f4f4; }
        form { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); width: 300px; }
        input { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        button { width: 100%; padding: 10px; background: #3ecf8e; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #36b37a; }
    </style>
</head>
<body>

    <form id="regForm">
        <h3>Регистрация</h3>
        <input type="text" id="username" placeholder="Логин (Username)" required>
        <input type="email" id="email" placeholder="Email" required>
        <input type="password" id="password" placeholder="Пароль" required>
        <button type="submit" id="btn">Создать аккаунт</button>
        <p id="msg"></p>
    </form>

    <script>
        // Инициализация Supabase
        const supabaseUrl = 'https://dkyqegxdcerlqnfvodjd.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRreXFlZ3hkY2VybHFuZnZvZGpkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAwNTc2NzQsImV4cCI6MjA4NTYzMzY3NH0.n6KO-IQMZboeOMCnJQw6gAs8DdWFDZpevAOWBQrxFWA';
        const supabase = supabase.createClient(supabaseUrl, supabaseKey);

        const form = document.getElementById('regForm');
        const msg = document.getElementById('msg');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            msg.innerText = 'Загрузка...';

            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const username = document.getElementById('username').value;

            // 1. Регистрация пользователя в Auth (почта и пароль)
            const { data, error } = await supabase.auth.signUp({
                email: email,
                password: password,
                options: {
                    // Сохраняем логин в метаданные пользователя
                    data: { display_name: username }
                }
            });

            if (error) {
                msg.style.color = 'red';
                msg.innerText = 'Ошибка: ' + error.message;
            } else {
                msg.style.color = 'green';
                msg.innerText = 'Успех! Проверьте почту для подтверждения.';
                form.reset();
            }
        });
    </script>
</body>
</html>
